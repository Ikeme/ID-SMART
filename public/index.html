<!doctype html>
<html>
  <head>
    <style>
      .download-btn {
        display: inline-block;
        padding: 10px 20px;
        background-color: #007bff;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        margin: 5px;
      }
      .download-btn:hover {
        background-color: #0056b3;
      }
    </style>
  </head>
  <body>
    <h2>FUTO Student ID Card</h2>
    <form method="post" enctype="multipart/form-data">
      Name: <input type="text" name="name" required><br>
      Reg Number: <input type="text" name="reg" required><br>     

      Faculty:
      <select name="faculty" required>
        <option value="">-- Select Faculty --</option>
        <option>AGRICULTURE AND AGRICULTURAL TECHNOLOGY</option>  
        <option>BASIC MEDICAL SCIENCES</option>
        <option>BIOLOGICAL SCIENCES</option>
        <option>CENTRE OF EXCELLENCE IN SUSTAINABLE PROCUREMENT, ENVIRONMENTAL AND SOCIAL STANDARDS</option>
        <option>ELECTRICAL SYSTEMS AND ENGINEERING TECHNOLOGY</option>
        <option>ENGINEERING & ENGINEERING TECHNOLOGY</option> 
        <option>ENVIRONMENTAL SCIENCE</option>
        <option>HEALTH TECHNOLOGY</option>
        <option>INFORMATION AND COMMUNICATION TECHNOLOGY</option> 
        <option>LOGISTICS AND INNOVATION TECHNOLOGY</option>      
        <option>MANAGEMENT TECHNOLOGY</option>
        <option>MEDICINE AND SURGERY</option>
        <option>PHYSICAL SCIENCES</option>
      </select><br>

      Department:
      <select name="dept" required>
        <option value="">-- Select Department --</option>
        <option>AGRICULTURAL BUSINESS</option>
        <option>AGRICULTURAL ECONOMICS</option>
        <option>AGRICULTURAL ENGINEERING</option>
        <option>AGRICULTURAL EXTENSION</option>
        <option>ANIMAL SCIENCE AND TECHNOLOGY</option>
        <option>ARCHITECTURE</option>
        <option>BIOCHEMISTRY</option>
        <option>BIOLOGY</option>
        <option>BIOMEDICAL ENGINEERING</option>
        <option>BIOTECHNOLOGY</option>
        <option>BUILDING TECHNOLOGY</option>
        <option>CHEMICAL ENGINEERING</option>
        <option>CHEMISTRY</option>
        <option>CIVIL ENGINEERING</option>
        <option>COMPUTER ENGINEERING</option>
        <option>COMPUTER SCIENCE</option>
        <option>CROP SCIENCE AND TECHNOLOGY</option>
        <option>CYBER SECURITY</option>
        <option>DENTAL TECHNOLOGY</option>
        <option>ELECTRICAL AND ELECTRONIC ENGINEERING</option>    
        <option>ELECTRICAL ENGINEERING</option>
        <option>ELECTRONIC ENGINEERING</option>
        <option>ENTREPRENEURSHIP AND INNOVATION</option>
        <option>ENVIRONMENTAL HEALTH SCIENCE</option>
        <option>ENVIRONMENTAL MANAGEMENT</option>
        <option>ESTATE MANAGEMENT & VALUATION</option>        
        <option>FISHERIES AND AQUACULTURE TECHNOLOGY</option>     
        <option>FOOD SCIENCE & TECHNOLOGY</option>
        <option>FORENSIC SCIENCE</option>
        <option>FORESTRY AND WILDLIFE TECHNOLOGY</option>
        <option>GEOLOGY</option>
        <option>HUMAN ANATOMY</option>
        <option>HUMAN PHYSIOLOGY</option>
        <option>INFORMATION TECHNOLOGY</option>
        <option>LOGISTICS AND TRANSPORT TECHNOLOGY</option>       
        <option>MARITIME MANAGEMENT TECHNOLOGY</option>
        <option>MATERIALS & METALLURGICAL ENGINEERING</option>
        <option>MATHEMATICS</option>
        <option>MECHANICAL ENGINEERING</option>
        <option>MECHATRONIC ENGINEERING</option>
        <option>MEDICINE AND SURGERY</option>
        <option>MICROBIOLOGY</option>
        <option>OPTOMETRY</option>
        <option>PETROLEUM ENGINEERING</option>
        <option>PHYSICS</option>
        <option>POLYMER & TEXTILE ENGINEERING</option>        
        <option>PROCUREMENT MANAGEMENT</option>
        <option>PROJECT MANAGEMENT TECHNOLOGY</option>
        <option>PROSTHETICS & ORTHOTICS</option>
        <option>PUBLIC HEALTH TECHNOLOGY</option>
        <option>QUANTITY SURVEYING</option>
        <option>RADIOGRAPHY</option>
        <option>SCIENCE LABORATORY TECHNOLOGY</option>
        <option>SOFTWARE ENGINEERING</option>
        <option>SOIL SCIENCE AND TECHNOLOGY</option>
        <option>STATISTICS</option>
        <option>SUPPLY CHAIN MANAGEMENT</option>
        <option>SURVEYING AND GEOINFORMATICS</option>
        <option>SUSTAINABLE ENVIRONMENTAL STUDIES</option>        
        <option>SUSTAINABLE SOCIAL DEVELOPMENT</option>
        <option>TELECOMMUNICATION ENGINEERING</option>
        <option>URBAN & REGIONAL PLANNING</option>
      </select><br>
    Gender: <input type="text" name="gender" required><br>        

      Expiry (e.g. 2021/2022): <input type="text" name="expiry" required><br>
      Passport Photo: <input type="file" name="photo" required><br>
      <input type="submit" value="Generate">
    </form>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const form = document.querySelector('form');
        const resultDiv = document.createElement('div');
        resultDiv.id = 'result';
        document.body.appendChild(resultDiv);

        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          // Clear previous results
          resultDiv.innerHTML = '<p>Generating ID card...</p>';
          
          const formData = new FormData(form);
          const reg = formData.get('reg').replace(/[^a-z0-9_-]/gi, '_'); // Sanitize reg for filename
          
          try {
            const response = await fetch('/generate', {
              method: 'POST',
              body: formData
            });
            
            const data = await response.json();
            
            if (data.success) {
              // Display front card image from Cloudinary
              const img = document.createElement('img');
              img.src = data.frontUrl;
              img.alt = 'Generated ID Card Front';
              img.style.maxWidth = '100%';
              img.style.marginBottom = '20px';
              
              // Create download buttons with Cloudinary URLs
              const frontBtn = document.createElement('a');
              frontBtn.href = data.frontUrl;
              frontBtn.download = `futo_${reg}_front.png`;
              frontBtn.target = '_blank';
              frontBtn.textContent = 'Download Front Card';
              frontBtn.className = 'download-btn';
              
              const backBtn = document.createElement('a');
              backBtn.href = data.backUrl;
              backBtn.download = `futo_${reg}_back.png`;
              backBtn.target = '_blank';
              backBtn.textContent = 'Download Back Card';
              backBtn.className = 'download-btn';
              
              // Update result div
              resultDiv.innerHTML = '<h3>ID Card Generated Successfully!</h3>';
              resultDiv.appendChild(img);
              resultDiv.appendChild(frontBtn);
              resultDiv.appendChild(backBtn);
            } else {
              resultDiv.innerHTML = `<p style="color: red;">Error: ${data.error}</p>`;
            }
          } catch (error) {
            resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
          }
        });
      });
    </script>
  </body>
</html>